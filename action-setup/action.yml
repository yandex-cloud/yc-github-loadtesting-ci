name: 'Setup tools'
description: 'Setup and configure required tools'
runs:
  using: "composite"
  steps:
    - name: Check secret is set
      run: |
        if [[ -z "$YC_LT_AUTHORIZED_KEY_JSON" ]]; then echo "YC_LT_AUTHORIZED_KEY_JSON is empty" && exit 1; else echo "YC_LT_AUTHORIZED_KEY_JSON is set"; fi
      shell: bash
    - name: Check out repository code
      uses: actions/checkout@v4
    - name: install utilities
      run: |
        sudo DEBIAN_FRONTEND=noninteractive apt update
        sudo DEBIAN_FRONTEND=noninteractive apt install -y curl jq
        sudo curl -f -s -LO https://storage.yandexcloud.net/yandexcloud-yc/install.sh
        sudo bash install.sh -i /usr/local/yandex-cloud -n
        sudo ln -sf /usr/local/yandex-cloud/bin/yc /usr/local/bin/yc
      shell: bash
    - name: configure yc cli
      run: |
        echo "$YC_LT_AUTHORIZED_KEY_JSON" > key.json
        yc config profile create sa-profile
        yc config set service-account-key ./key.json
        yc config set format json
        yc config set folder-id "$YC_LT_FOLDER_ID"
      shell: bash


